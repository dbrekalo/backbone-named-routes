!function(a,b){"function"==typeof define&&define.amd?define(["jquery","backbone","underscore"],b):"object"==typeof module&&module.exports?module.exports=b(require("jquery"),require("backbone"),require("underscore")):a.BackboneNamedRouter=b(a.jQuery,a.Backbone,a._)}(this,function(a,b,c){var d=/\((.*?)\)|(\(\?)?:\w+|\*\w+/g,e=/\((.*?)\)/g,f=/\:\w+/,g=/\(|\)/g,h=/\:\w+|\*\w+/,i=/\/$/,j=function(a){return a?a.replace(i,""):""},k=function(a,b){return a.substr(0,b.length)===b},l=b.Router.extend({constructor:function(a){this.options=c.extend({baseUrl:"undefined"!=typeof window?window.location.protocol+"//"+window.location.host:""},a),b.Router.apply(this,arguments)},route:function(a,c,d){this.namedRoutes=this.namedRoutes||{},this.namedRoutes[c]=a,b.Router.prototype.route.apply(this,arguments)},get:function(c,i,k){var l=this.namedRoutes[c],m=this.options.baseUrl,n=b.history._usePushState,o=b.history.root,p="";if("undefined"==typeof l)throw new Error('Route "'+c+'" is not defined');return 0===l.length?p=m+j(o):(l=l.replace(d,function(a){var b=a.match(h)[0].slice(1),d=i[b],j="undefined"!=typeof d;if(a.match(e))return j?a.replace(g,"").replace(f,d):"";if(j)return d;throw new Error('Required route parameter "'+b+'" for route "'+c+'" is missing')}),p=n?m+o+l:m+j(o)+"#"+l),k&&(p+="?"+a.param(k)),p},navigateToUrl:function(c,d){var e=c instanceof a?c.attr("href"):c,f=this.options.baseUrl,g=b.history._usePushState,h=j(b.history.root);k(e,f)&&(e=e.replace(f,"")),k(e,h)&&(e=e.replace(h,"")),k(e,"/")&&(e=e.slice(1)),!g&&k(e,"#")&&(e=e.slice(1)),this.navigate(e,{trigger:!!d})},navigateToRoute:function(a,b,c,d){this.navigateToUrl(this.get(a,b,c),d)}});return l});