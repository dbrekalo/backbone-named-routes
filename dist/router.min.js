!function(a,b){"function"==typeof define&&define.amd?define(["jquery","backbone","underscore"],b):"object"==typeof module&&module.exports?module.exports=b(require("jquery"),require("backbone"),require("underscore")):a.BackboneNamedRouter=b(a.jQuery,a.Backbone,a._)}(this,function(a,b,c){var d=this,e=/\((.*?)\)|(\(\?)?:\w+|\*\w+/g,f=/\((.*?)\)/g,g=/\:\w+/,h=/\(|\)/g,i=/\:\w+|\*\w+/,j=/\/$/,k=function(a){return a.replace(j,"")},l=function(a,b){return a.substr(0,b.length)===b},m=b.Router.extend({constructor:function(a){this.options=c.extend({baseUrl:d.location.protocol+"//"+d.location.host},a),b.Router.apply(this,arguments)},route:function(a,c,d){this.namedRoutes=this.namedRoutes||{},this.namedRoutes[c]=a,b.Router.prototype.route.apply(this,arguments)},get:function(c,d,j){var l=this.namedRoutes[c],m=this.options.baseUrl,n=b.history._usePushState,o=b.history.root,p="";if("undefined"==typeof l)throw new Error('Route "'+c+'" is not defined');return l.length?(l=l.replace(e,function(a){var b=a.match(i)[0].slice(1),e=d[b],j="undefined"!=typeof e;if(a.match(f))return j?a.replace(h,"").replace(g,e):"";if(j)return e;throw new Error('Required route parameter "'+b+'" for route "'+c+'" is missing')}),p=n?m+o+l:m+k(o)+"#"+l):p=m+k(o),j&&(p+="?"+a.param(j)),p},navigateToUrl:function(c,d){var e=c instanceof a?c.attr("href"):c,f=this.options.baseUrl,g=b.history._usePushState,h=k(b.history.root);l(e,f)&&(e=e.replace(f,"")),l(e,h)&&(e=e.replace(h,"")),l(e,"/")&&(e=e.slice(1)),!g&&l(e,"#")&&(e=e.slice(1)),this.navigate(e,{trigger:!!d})},navigateToRoute:function(a,b,c,d){this.navigateToUrl(this.get(a,b,c),d)}});return m});